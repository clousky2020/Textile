<div class="row">
  <div class="col-md-3">
    <div class="last_week_status">
      <h3>最近7天的情况</h3>
      <div>
        <p>有<%= @last_week_purchase_orders.size %>张采购单</p>
        <p>有<%= @last_week_sale_orders.size %>张销售单</p>
        <p>有<%= @last_week_proceeds.size %>张收款单</p>
        <p>有<%= @last_week_expenses.size %>张付款单</p>
      </div>
    </div>
    <div class="operations_can_do">
      <h3>可以做的操作</h3>
      <div class="not_pass_content">
        <% if can? :pass_check, Expense %>
          <% if @not_pass_expenses.count > 0 %>
            <div>
              审核付款单<span class="badge badge-warning">
        <%= link_to @not_pass_expenses.count, expense_index_path(type: "check_status:false") %> </span>
            </div>
          <% end %>
        <% end %>
        <% if can? :pass_check, Proceed %>
          <% if @not_pass_proceeds.count > 0 %>
            <div>
              审核收款单<span class="badge badge-warning">
        <%= link_to @not_pass_proceeds.count, proceed_index_path(type: "check_status:false") %></span>
            </div>
          <% end %>
        <% end %>
        <% if can? :pass_check, SaleOrder %>
          <% if @not_pass_sale_orders.count > 0 %>
            <div>
              审核销售单<span class="badge badge-warning">
        <%= link_to @not_pass_sale_orders.count, sale_order_index_path(type: "check_status:false") %></span>
            </div>
          <% end %>
        <% end %>
        <% if can? :pass_check, PurchaseOrder %>
          <% if @not_pass_purchase_orders.count > 0 %>
            <div>
              审核采购单<span class="badge badge-warning">
        <%= link_to @not_pass_purchase_orders.count, purchase_order_index_path(type: "check_status:false") %></span>
            </div>
          <% end %>
        <% end %>
        <% if can? :pass_reimburse_expense, Expense %>
          <% if @not_pass_purchase_orders.count > 0 %>
            <div>
              还有未报销单<span class="badge badge-warning">
        <%= link_to @need_reimburses.count, expense_index_path(type: "need_reimburses:true") %></span>
            </div>
          <% end %>
        <% end %>
        <hr>
      </div>
      <div class="create_order">
        <% if can? :create, Expense %>
          <div class="btn">
            <%= link_to "填写新的付款单", new_expense_path %>
          </div>
        <% end %>
        <% if can? :create, Proceed %>
          <div class="btn">
            <%= link_to "填写新的收款单", new_proceed_path %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="col-md-9">
    <h3>图表查询</h3>
    <div class="row no-gutters">
      <%= form_with url: check_sale_proceed_url do |f| %>
        <div class="input-group">
        <%= f.label :start_date, "开始日期" %>
        <%= f.date_field :start_date, value: (Time.current - 7.days).strftime("%Y-%m-%d") %>
        </div>
        <div class="input-group">
        <%= f.label :end_date, "结束日期" %>
        <%= f.date_field :end_date, value: default_date_now %>
        <%= f.submit "查询" %>
        </div>
      <% end %>
    </div>
    <div class="chart-container">
      <canvas id="check_sale_proceed_chart"></canvas>
      <canvas id="check_purchase_expense_chart"></canvas>
      <canvas id="check_proceed_expense_chart"></canvas>
    </div>

  </div>
</div>